apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base Online Boutique configuration
resources:
  - ../../base

# Remove the load generator using the official component
components:
  - ../../components/without-loadgenerator

# Modern patch mechanism (JSON 6902)
patches:
  # Reduce CPU request for emailservice
  - target:
      kind: Deployment
      name: emailservice
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/cpu
        value: "50m"

  # Reduce CPU request for recommendationservice
  - target:
      kind: Deployment
      name: recommendationservice
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/cpu
        value: "50m"

  
  - target:
      kind: Deployment
      name: recommendationservice
    patch: |-
      - op: add
        path: /spec/template/metadata/annotations
        value:
          sidecar.istio.io/inject: "true"

